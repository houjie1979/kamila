<?phprequire_once('../includes/initialize.php');$tablename = "Holdings";if(isset($_GET['new'])) {	// new Form has been submitted  $nref['hold_key'] = strtoupper(trim($_GET['hold_key']));  $id="";    if(!$session->allow('enter')) $message = "Can't ";  $message .= "Create new record in " . $tablename . " table"; }if (isset($_POST['edit'])) { // edit Form has been submitted.	$id = $_POST['id']; 	$current_record = Holdings::find_rec_by_id($id);	$message = "Editing record " . $id . " of " . $tablename . " table";}if (isset($_POST['save'])) { // save Form has been submitted.	$nref['hold_key'] = strtoupper(trim($_POST['hold_key']));	$nref['type_code'] = trim($_POST['type_code']);	$nref['journal_code'] = strtoupper(trim($_POST['journal_code']));	$nref['vol'] = trim($_POST['vol']);	$nref['issue'] = trim($_POST['issue']);	$nref['pages'] = trim($_POST['pages']);	$nref['year'] = trim($_POST['year']);	$nref['article_title'] = trim($_POST['article_title']);	$nref['lang_code'] = strtoupper(trim($_POST['lang_code']));	$nref['fauthor_code'] = strtoupper(trim($_POST['fauthor_code']));	$nref['cauthor_code'] = strtoupper(trim($_POST['cauthor_code']));		$nref['chem_abs'] = trim($_POST['chem_abs']);	$nref['asc_top'] = trim($_POST['asc_top']);	$nref['biosis'] = trim($_POST['biosis']);	$nref['inspec'] = trim($_POST['inspec']);	$nref['phys'] = trim($_POST['phys']);	$nref['energy'] = trim($_POST['energy']);	$nref['scisearch'] = trim($_POST['scisearch']);	$nref['ldate'] = trim($_POST['ldate']);	$nref['sdate'] = trim($_POST['sdate']);	$nref['rdate'] = trim($_POST['rdate']);	$nref['edate'] = trim($_POST['edate']);	$nref['abstractor'] = $session->username;	$nref['comments'] = trim($_POST['comments']);	$nref['intercomments'] = trim($_POST['intercomments']);	$nref['see_ref_key'] = strtoupper(trim($_POST['see_ref_key']));	$nref['flag_code'] = strtoupper(trim($_POST['flag_code']));	$nref['unsol_flag'] = strtoupper(trim($_POST['unsol_flag']));	$nref['abstract'] = trim($_POST['abstract']);	$nref['citations'] = trim($_POST['citations']);	$nref['indexterms'] = trim($_POST['indexterms']);     	if($_POST['id'] != "" && $session->allow('update'))  {	// update existing record		$nref['id'] = $_POST['id'];	  	$current_record[0] = Holdings::instantiateit($nref);			if(Holdings::authenticate($current_record[0]->hold_key)->id == $current_record[0]->id) { // update record			$current_record[0]->save();				$message = "Record updated in " . $tablename . " table";		}			else $message = "can't update record";				}	else {	// create new record	    if($session->allow('enter')){		unset($nref['id']);  		$current_record[0] = Holdings::instantiateit($nref);				if(Holdings::authenticate($current_record[0]->hold_key))	$message = "Code already exists in " . $tablename . " table";		else {				$current_record[0]->save();			$message = "Record createded in " . $tablename . " table";		}			}	else $message = "Can't create new record. No create privilege";	}}    if (isset($_POST['delete'])) { // delete Form has been submitted.	if($_POST['id'] != ""  && $session->allow('delete')) {		$delrecord = new Holdings;		$delrecord->id = $_POST['id'];		$message = "Record ".$delrecord->full_name. " is deleted from " . $tablename . " table.";		$delrecord->delete();		unset($id);	}	    else $message = "Record is not deleted. No delete privilege";}       ?><?php include_layout_template('header.php'); ?><?php echo output_message($message); ?>	<div id="data">		<form action="editholding.php" method="post">		  <table>		        <input type="hidden" name="id"  value="<?php echo $current_record[0]->id; ?>" />		    <tr>		      <td>Hold key:</td>		      <td>			<input type="text" name="hold_key"  size="8" maxlength="6" value="<?php echo $current_record[0]->hold_key ?>" />		      </td>		      <td>Type code:</td>		      <td>		        <input type="text" name="type_code" size="1" maxlength="1" value="<?php echo $current_record[0]->type_code; ?>" />		      </td>		      <td>Lang code:</td>		      <td>		        <input type="text" name="lang_code" size="3" maxlength="3" value="<?php echo $current_record[0]->lang_code; ?>" />		      </td>		      <td>Abstractor:</td>			  <td><?php echo $current_record[0]->abstractor ?></td>		    </tr>		    <tr>		      <td>Journal code:</td>		      <td>		        <input type="text" name="journal_code" size="6" maxlength="6" value="<?php echo $current_record[0]->journal_code; ?>" />		      </td>			  <td colspan="3"><?php echo $current_record[0]->journal_name; ?></td>		      <td>Fauthor code:</td>		      <td>		        <input type="text" name="fauthor_code" size="6" maxlength="6" value="<?php echo $current_record[0]->fauthor_code; ?>" />		      </td>		      <td>Cauthor code:</td>		      <td>		        <input type="text" name="cauthorl_code" size="6" maxlength="6" value="<?php echo $current_record[0]->cauthor_code; ?>" />		      </td>		    </tr>		    <tr>		      <td>Vol:</td>		      <td>		        <input type="text" name="vol" size="10" maxlength="20" value="<?php echo $current_record[0]->vol; ?>" />		      </td>		      <td>Issue:</td>		      <td>		        <input type="text" name="issue" size="10" maxlength="10" value="<?php echo $current_record[0]->issue; ?>" />		      </td>		      <td>Pages:</td>		      <td>		        <input type="text" name="pages" size="10" maxlength="20" value="<?php echo $current_record[0]->pages; ?>" />		      </td>		      <td>Year:</td>		      <td>		        <input type="text" name="year" size="4" maxlength="4" value="<?php echo $current_record[0]->year; ?>" />		      </td>		    </tr>		    <tr>		      <td>Article title:</td>		      <td colspan="9">		        <textarea rows="4" cols="110" name="article_title"><?php echo $current_record[0]->article_title; ?> </textarea>  		      </td>		    </tr>		    <tr>		      <td>Chem abs:</td>		      <td>		        <input type="text" name="chem_abs" size="16" maxlength="16" value="<?php echo $current_record[0]->chem_abs; ?>" />		      </td>		      <td>Scisearch:</td>		      <td>		        <input type="text" name="scisearch" size="10" maxlength="10" value="<?php echo $current_record[0]->scisearch; ?>" />		      </td>		      <td>Biosis:</td>		      <td>		        <input type="text" name="biosis" size="9" maxlength="9" value="<?php echo $current_record[0]->biosis; ?>" />		      </td>		    </tr>		    <tr>		      <td>Asca:</td>		      <td>		        <input type="text" name="asca" size="16" maxlength="20" value="<?php echo $current_record[0]->asca; ?>" />		      </td>		      <td>Phys:</td>		      <td>		        <input type="text" name="phys" size="13" maxlength="13" value="<?php echo $current_record[0]->phys; ?>" />		      </td>		      <td>Inspec:</td>		      <td>		        <input type="text" name="inspec" size="11" maxlength="11" value="<?php echo $current_record[0]->inspec; ?>" />		      </td>		      <td>Energy:</td>		      <td>		        <input type="text" name="energy" size="13" maxlength="13" value="<?php echo $current_record[0]->energy; ?>" />		      </td>		    </tr>		    <tr>		      <td>Ldate:</td>		      <td>		        <input type="text" name="ldate" size="10" maxlength="10" value="<?php echo $current_record[0]->ldate; ?>" />		      </td>		      <td>Sdate:</td>		      <td>		        <input type="text" name="sdate" size="10" maxlength="10" value="<?php echo $current_record[0]->sdate; ?>" />		      </td>		      <td>Rdate:</td>		      <td>		        <input type="text" name="rdate" size="10" maxlength="10" value="<?php echo $current_record[0]->rdate; ?>" />		      </td>		      <td>Edate:</td>		      <td>		        <input type="text" name="edate" size="10" maxlength="10" value="<?php echo $current_record[0]->edate; ?>" />		      </td>		    </tr>		    <tr>		      <td>Comments:</td>		      <td colspan="9">		        <input type="text" name="comments" size="30" maxlength="30" value="<?php echo $current_record[0]->comments; ?>" />		      </td>		    </tr>		    <tr>		      <td>See ref key:</td>		      <td>		        <input type="text" name="see_ref_key" size="6" maxlength="6" value="<?php echo $current_record[0]->see_ref_key; ?>" />		      </td>		      <td>Flag code:</td>		      <td>		        <input type="text" name="flag_code" size="1" maxlength="1" value="<?php echo $current_record[0]->flag_code; ?>" />		      </td>		      <td>Unsol flag:</td>		      <td>		        <input type="text" name="unsol_flag" size="1" maxlength="1" value="<?php echo $current_record[0]->unsol_flag; ?>" />		      </td>		    </tr>		    <tr>		      <td>Abstract:</td>		      <td colspan="9">		        <textarea rows="5" cols="110" name="abstract"><?php echo $current_record[0]->abstract; ?> </textarea>  		      </td>		    </tr>		    <tr>		      <td>Citations:</td>		      <td colspan="9">		        <textarea rows="5" cols="110" name="citations"><?php echo $current_record[0]->citations; ?> </textarea>  		      </td>		    </tr>		    <tr>		      <td>Index Terms:</td>		      <td colspan="9">		        <textarea rows="5" cols="110" name="index_terms"><?php echo $current_record[0]->index_terms; ?> </textarea>  		      </td>		    </tr>		    <tr>			<td colspan='2'><input type='submit' name = 'delete' value='Delete' /></td>			<td colspan='2'><input type='submit' name = 'save' value='Save' /></td>			<td colspan='2'><a href="listholdings.php">Done</a></td>		    </tr>		  </table>		</form><?php 	?></div><?php include_layout_template('footer.php'); ?>		