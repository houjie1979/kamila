<?phprequire_once('../includes/initialize.php');$message = "";if(isset($_POST['gethold'])) {	// get holdings Form has been submitted    $holdkey = strtoupper(trim($_POST['holdkey']));	$found_records = Holdings::get_by_refkey($holdkey);	$ref = $found_records[0];//	$ref->add_definitions();	if(isset($ref)) $message = "Found Reference ".$holdkey; else $message = "Not found ".$holdkey;}if(isset($_POST['save'])) {	// save holding Form has been submitted if($session->allow('enter')) {	$nref['id'] = trim($_POST['id']);	$nref['hold_key'] = strtoupper(trim($_POST['hold_key']));	$nref['type_code'] = trim($_POST['type_code']);	$nref['journal_code'] = strtoupper(trim($_POST['journal_code']));	$nref['vol'] = trim($_POST['vol']);	$nref['issue'] = trim($_POST['issue']);	$nref['pages'] = trim($_POST['pages']);	$nref['year'] = trim($_POST['year']);	$nref['article_title'] = trim($_POST['article_title']);	$nref['lang_code'] = strtoupper(trim($_POST['lang_code']));	$nref['chem_abs'] = trim($_POST['chem_abs']);	$nref['asc_top'] = trim($_POST['asc_top']);	$nref['biosis'] = trim($_POST['biosis']);	$nref['inspec'] = trim($_POST['inspec']);	$nref['phys'] = trim($_POST['phys']);	$nref['energy'] = trim($_POST['energy']);	$nref['scisearch'] = trim($_POST['scisearch']);	$nref['ldate'] = trim($_POST['ldate']);	$nref['sdate'] = trim($_POST['sdate']);	$nref['rdate'] = trim($_POST['rdate']);	if(isset($_POST['received'])) $nref['rdate'] = date('Y/m/j');	if(isset($_POST['edited'])) $nref['edate'] = date('Y/m/j');	else	$nref['edate'] = trim($_POST['edate']);	$nref['fauthor_code'] = strtoupper(trim($_POST['fauthor_code']));	$nref['cauthor_code'] = strtoupper(trim($_POST['cauthor_code']));	$nref['cauthor_position'] = trim($_POST['cauthor_position']);	$nref['intercomments'] = trim($_POST['intercoments']);	$nref['abstractor'] = $session->username;	$nref['comments'] = trim($_POST['comments']);	$nref['see_ref_key'] = strtoupper(trim($_POST['see_ref_key']));	$nref['flag_code'] = strtoupper(trim($_POST['flag_code']));	$nref['abstract'] = trim($_POST['abstract']);	$nref['unsol_flag'] = strtoupper(trim($_POST['unsol_flag']));	$nref['citations'] = trim($_POST['citations']);	$nref['index_terms'] = trim($_POST['index_terms']);	$ref = Holdings::instantiateit($nref);	$holdkey = $ref->hold_key;	$ref->add_definitions();	if($ref->id == "") {  // new holding entered		if($ref->hold_key == "") $message = "No Holdkey";		else {  // get the next available holding key			$ref->hold_key = Holdings::get_new_holdkey($ref->hold_key,$ref->year);			if(!Journals::legit_journ_code($ref->journal_code)) $message = "Wrong journal code ".$ref->journal_code;			 else if(!Languages::legit_lang_code($ref->lang_code)) $message = "Wrong language code ".$ref->lang->code;			 	  else if(!Names::legit_author($ref->fauthor_code)) $message = "Wrong first author code".$ref->fauthor_code;				  		else if($ref->save()) 	$message = " Record saved ".$ref->hold_key;			else $message = " Could not save ".$ref->hold_key;		}	}	else	if($ref->save()) 	$message = " Record updated ".$ref->hold_key;			else $message = " Could not update  ".$ref->hold_key; } else $message = "Update is not allowed";}if(isset($_POST['delete'])) {	// delete reference Form has been submitted	$message = "Delete is not activated";}?><?php include_layout_template('header.php'); ?><div id="leftcol"><h3>Edit Holding</h3>		<form action="editholdings.php" method="post">		  <table>		    <tr>		      <td>Hold key:</td>		      <td>		        <input type="text" name="holdkey" size="6" maxlength="6" value="<?php echo $holdkey; ?>" />		      </td>		    </tr>			<tr>		      <td >		        <input type="submit" name="gethold" value="Get" />			  </td>			</tr>	  </table>	</br>	</br>    <form action=''> <input type="button" onclick="OpenInNewTab('checkname.php');" value="Checkup name"/></form><?php	echo $message."</br>"; ?><?php ?></div>		<div id="data">		<form action="editholdings.php" method="post">		  <table>		        <input type="hidden" name="id"  value="<?php echo $ref->id; ?>" />		    <tr>		      <td>Holdkey:</td>		      <td>		        <input type="text" name="hold_key" size="6" maxlength="6" value="<?php echo $ref->hold_key; ?>" />		      </td>		      <td>Type code:</td>		      <td>		        <input type="text" name="type_code" size="1" maxlength="1" value="<?php echo $ref->type_code; ?>" />		      </td>		      <td>Lang code:</td>		      <td>		        <input type="text" name="lang_code" size="3" maxlength="3" value="<?php echo $ref->lang_code; ?>" />		      </td>		      <td>Abstractor:</td>		      <td ><?php echo $ref->abstractor; ?></td>		    </tr>		    <tr>		      <td>Journal code:</td>		      <td>		        <input type="text" name="journal_code" size="6" maxlength="6" value="<?php echo $ref->journal_code; ?>" />		      </td>		      <td  colspan="6"><?php echo $ref->journal_name; ?></td>		    </tr>		    <tr>		      <td>Comments:</td>		      <td colspan="9">		        <input type="text" name="comments" size="120" maxlength="120" value="<?php echo $ref->comments; ?>" />		      </td>		    </tr>		    <tr>		      <td>Vol:</td>		      <td>		        <input type="text" name="vol" size="10" maxlength="20" value="<?php echo $ref->vol; ?>" />		      </td>		      <td>Issue:</td>		      <td>		        <input type="text" name="issue" size="10" maxlength="60" value="<?php echo $ref->issue; ?>" />		      </td>		      <td>Pages:</td>		      <td>		        <input type="text" name="pages" size="10" maxlength="20" value="<?php echo $ref->pages; ?>" />		      </td>		      <td>Year:</td>		      <td>		        <input type="text" name="year" size="4" maxlength="4" value="<?php echo $ref->year; ?>" />		      </td>		    </tr>		    <tr>		      <td>Article title:</td>		      <td colspan="9">		        <textarea rows="4" cols="110" name="article_title"><?php echo $ref->article_title; ?> </textarea>  		      </td>		    </tr>		    <tr>		      <td>Fauthor code:</td>		      <td>		        <input type="text" name="fauthor_code" size="6" maxlength="6" value="<?php echo $ref->fauthor_code; ?>" />		      </td>		      <td><?php echo $ref->first_author_name; ?></td>		      <td>Corr auth:</td>		      <td>		        <input type="text" name="cauthor_code" size="6" maxlength="6" value="<?php echo $ref->cauthor_code; ?>" />		      </td>		      <td><?php echo $ref->corresponding_name; ?></td>		      <td>Corr pos:</td>		      <td>		        <input type="text" name="cauthor_position" size="2" maxlength="2" value="<?php echo $ref->cauthor_position; ?>" />		      </td>			 </tr>		    <tr>		      <td>InterComm:</td>		      <td colspan="9">		        <input type="text" name="intercomments" size="120" maxlength="120" value="<?php echo $ref->intercomments; ?>" />		      </td>		    <tr>		      <td>Chem abs:</td>		      <td>		        <input type="text" name="chem_abs" size="16" maxlength="16" value="<?php echo $ref->chem_abs; ?>" />		      </td>		      <td>Scisearch:</td>		      <td>		        <input type="text" name="scisearch" size="12" maxlength="16" value="<?php echo $ref->scisearch; ?>" />		      </td>		      <td>Biosis:</td>		      <td>		        <input type="text" name="biosis" size="9" maxlength="9" value="<?php echo $ref->biosis; ?>" />		      </td>		    </tr>		    <tr>		      <td>Asca:</td>		      <td>		        <input type="text" name="asca" size="16" maxlength="20" value="<?php echo $ref->asca; ?>" />		      </td>		      <td>Phys:</td>		      <td>		        <input type="text" name="phys" size="13" maxlength="13" value="<?php echo $ref->phys; ?>" />		      </td>		      <td>Inspec:</td>		      <td>		        <input type="text" name="$ref->inspec" size="11" maxlength="11" value="<?php echo $ref->inspec; ?>" />		      </td>		      <td>Energy:</td>		      <td>		        <input type="text" name="energy" size="13" maxlength="13" value="<?php echo $ref->energy; ?>" />		      </td>		    </tr>		    <tr>		      <td>Ldate:</td>		      <td>		        <input type="text" name="ldate" size="10" maxlength="10" value="<?php echo $ref->ldate; ?>" />		      </td>		      <td>Sdate:</td>		      <td>		        <input type="text" name="sdate" size="10" maxlength="10" value="<?php echo $ref->sdate; ?>" />		      </td>		      <td>Rdate:</td>		      <td>		        <input type="text" name="rdate" size="10" maxlength="10" value="<?php echo $ref->rdate; ?>" />		      </td>		      <td>Edate:</td>		      <td>		        <input type="text" name="edate" size="10" maxlength="10" value="<?php echo $ref->edate; ?>" />		      </td>		    </tr>		    </tr>		    <tr>		      <td>See ref key:</td>		      <td>		        <input type="text" name="see_ref_key" size="6" maxlength="6" value="<?php echo $ref->see_ref_key; ?>" />		      </td>		      <td>Flag code:</td>		      <td>		        <input type="text" name="flag_code" size="1" maxlength="1" value="<?php echo $ref->flag_code; ?>" />		      </td><?php 	if(empty($ref->rdate)) echo "<td><input type='checkbox' name='received' /> - received today </td>";?>		      <td>Unsol flag:</td>		      <td>		        <input type="text" name="unsol_flag" size="1" maxlength="1" value="<?php echo $ref->unsol_flag; ?>" />		      </td><?php 	if(!empty($ref->rdate)) echo "<td><input type='checkbox' name='edited' /> - edited today </td>";?>		      		      		    </tr>		    <tr>		      <td>Abstract:</td>		      <td colspan="9">		        <textarea rows="5" cols="110" name="abstract"><?php echo $ref->abstract; ?> </textarea>  		      </td>		    </tr>		    <tr>		      <td>Citations:</td>		      <td colspan="9">		        <textarea rows="5" cols="110" name="citations"><?php echo $ref->citations; ?> </textarea>  		      </td>		    </tr>		    <tr>		      <td>Index Terms:</td>		      <td colspan="9">		        <textarea rows="5" cols="110" name="index_terms"><?php echo $ref->index_terms; ?> </textarea>  		      </td>			</tr>			<tr>			  <td colspan=3><?php		if(isset($ref))			echo "<input type='submit' name = 'delete' value='Delete' />";?>			    			  </td>			<td colspan='2'><input type='submit' name = 'save' value='Save' /></td></tr>		    </tr>		  </table>		</form>	</div><?php include_layout_template('footer.php'); ?>		