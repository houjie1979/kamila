<?phprequire_once('../includes/initialize.php');$tablename = "Keyword_code";if(isset($_GET['new'])) {	// new Form has been submitted  $entry['keyword_code'] = strtoupper(trim($_GET['keyword_code']));  $entry['definition'] = trim($_GET['definition']);  $entry['subject_title'] = trim($_GET['subject_title']);  $entry['subject_flag'] = strtoupper(trim($_GET['subject_flag']));  $entry['begin_use'] = trim($_GET['begin_use']);  $entry['not_kw1'] = strtoupper(trim($_GET['not_kw1']));  $entry['not_kw2'] = strtoupper(trim($_GET['not_kw2'])); $id="";   if(!$session->allow('enter')) $message = "Can't ";  $message .= "Create new record in " . $tablename . " table"; }if (isset($_POST['edit'])) { // edit Form has been submitted.	$id = $_POST['id']; 	$current_record = Keycodes::find_rec_by_id($id);	$message = "Editing record " . $id . " of " . $tablename . " table";}if (isset($_POST['save'])) { // save Form has been submitted.  	$entry['keyword_code'] = strtoupper(trim($_POST['keyword_code']));  	$entry['definition'] = trim($_POST['definition']);	$entry['subject_title'] = trim($_POST['subject_title']);	$entry['subject_flag'] = strtoupper(trim($_POST['subject_flag']));	$entry['begin_use'] = trim($_POST['begin_use']);	$entry['not_kw1'] = strtoupper(trim($_POST['not_kw1']));	$entry['not_kw2'] = strtoupper(trim($_POST['not_kw2']));	if($_POST['id'] != "" && $session->allow('update'))  {	// update existing record		$entry['id'] = $_POST['id'];	  	$current_record[0] = Keycodes::instantiateit($entry);			if(Keycodes::authenticate($current_record[0]->keyword_code)->id == $current_record[0]->id) { // update record			$current_record[0]->save();				$message = "Record updated in " . $tablename . " table";		}			else $message = "can't update record";				}	else {	// create new record	      if($session->allow('enter')){		unset($entry['id']);  		$current_record[0] = Keycodes::instantiateit($entry);				if(Keycodes::authenticate($current_record[0]->keyword_code))	$message = "Code already exists in " . $tablename . " table";		else {				$current_record[0]->save();			$message = "Record createded in " . $tablename . " table";		}			}	  else $message = "Can't create new record. No create privilege";	}}if (isset($_POST['delete'])) { // delete Form has been submitted.	if($_POST['id'] != "" && $session->allow('delete')) {		$delrecord = new Keycodes;		$delrecord->id = $_POST['id'];		$message = "Record ".$delrecord->full_name. " is deleted from " . $tablename . " table.";		$delrecord->delete();		unset($id);	}    else $message = "Record is not deleted. No delete privilege";}?><?php include_layout_template('header.php'); ?><?php echo output_message($message); ?>		<form action="editkeywordcode.php" method="post">		  <table>		        <input type="hidden" name="id"  value="<?php echo $id; ?>" />		    <tr>		      <td>Keyword Code:</td>		      <td>		        <input type="text" name="keyword_code" maxlength="3" value="<?php echo htmlentities($current_record[0]->keyword_code); ?>" />		      </td>		    </tr>		    <tr>		      <td>Definition:</td>		      <td>		        <input type="text" name="definition" maxlength="200" value="<?php echo htmlentities($current_record[0]->definition); ?>" />		      </td>		    </tr>		    <tr>		      <td>Subject Title:</td>		      <td>		        <input type="text" name="subject_title" maxlength="100" value="<?php echo htmlentities($current_record[0]->subject_title); ?>" />		      </td>		    </tr>		    <tr>		      <td>Subject Flag:</td>		      <td>		        <input type="text" name="subject_flag" maxlength="1" value="<?php echo htmlentities($current_record[0]->subject_flag); ?>" />		      </td>		    </tr>		    <tr>		    <tr>		      <td>Begin use:</td>		      <td>		        <input type="text" name="begin_use" maxlength="10" value="<?php echo htmlentities($current_record[0]->begin_use); ?>" />		      </td>		    </tr>		    <tr>		      <td>Not keyword 1:</td>		      <td>		        <input type="text" name="not_kw1" maxlength="3" value="<?php echo htmlentities($current_record[0]->not_kw1); ?>" />		      </td>		    </tr>		    <tr>		      <td>Not keyword 2:</td>		      <td>		        <input type="text" name="not_kw2" maxlength="3" value="<?php echo htmlentities($current_record[0]->not_kw2); ?>" />		      </td>		    </tr>		    <tr>		      <td colspan="1">		        <input type="submit" name="save" value="Save" />		      </td>			  <td colspan="1">		        <input type="submit" name="delete" value="Delete" />		      </td>		    </tr>		  </table>		</form>		<a href="listkeywordcodes.php">Done</a><?php include_layout_template('admin_footer.php'); ?>		