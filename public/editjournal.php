<?phprequire_once('../includes/initialize.php');$tablename = "Journals";if(isset($_GET['new'])) {	// new Form has been submitted  $nref['journal_code'] = strtoupper(trim($_GET['journal_code']));  $nref['title'] = trim($_GET['title']);  $id="";    if(!$session->allow('enter')) $message = "Can't ";  $message .= "Create new record in " . $tablename . " table"; }if (isset($_POST['edit'])) { // edit Form has been submitted.	$id = $_POST['id']; 	$current_record = Journals::find_rec_by_id($id);	$message = "Editing record " . $id . " of " . $tablename . " table";}if (isset($_POST['save'])) { // save Form has been submitted.	$nref['journal_code'] = strtoupper(trim($_POST['journal_code']));	$nref['title'] = trim($_POST['title']);	$nref['title_abb'] = trim($_POST['title_abb']);	$nref['lang_code'] = strtoupper(trim($_POST['lang_code']));	$nref['lib_congress'] = trim($_POST['lib_congress']);	$nref['trans_code'] = strtoupper(trim($_POST['trans_code']));	$nref['comments'] = trim($_POST['comments']);	$nref['unca_flag'] = strtoupper(trim($_POST['unca_flag']));	$nref['library_code'] = strtoupper(trim($_POST['library_code']));	$nref['flag_code'] = strtoupper(trim($_POST['flag_code']));	$nref['year_discontinued'] = trim($_POST['year_discontinued']);	$nref['old_code'] = strtoupper(trim($_POST['old_code']));	$nref['new_code'] = strtoupper(trim($_POST['new_code']));	$nref['year_started'] = trim($_POST['year_started']);	$nref['first_vol'] = trim($_POST['first_vol']);	$nref['issn_code'] = trim($_POST['issn_code']);     	if($_POST['id'] != "" && $session->allow('update'))  {	// update existing record		$nref['id'] = $_POST['id'];	  	$current_record[0] = Journals::instantiateit($nref);			if(Journals::authenticate($current_record[0]->journal_code)->id == $current_record[0]->id) { // update record			$current_record[0]->save();				$message = "Record updated in " . $tablename . " table";		}			else $message = "can't update record";				}	else {	// create new record	    if($session->allow('enter')){		unset($nref['id']);  		$current_record[0] = Journals::instantiateit($nref);				if(Journals::authenticate($current_record[0]->journal_code))	$message = "Code already exists in " . $tablename . " table";		else {				$current_record[0]->save();			$message = "Record createded in " . $tablename . " table";		}			}    	  else $message = "Can't create new record. No create privilege";	}}    if (isset($_POST['delete'])) { // delete Form has been submitted.	if($_POST['id'] != "" && $session->allow('delete')) {		$delrecord = new Journals;		$delrecord->id = $_POST['id'];		$message = "Record ".$delrecord->full_name. " is deleted from " . $tablename . " table.";		$delrecord->delete();		unset($id);	}	    else $message = "Record is not deleted. No delete privilege";}       ?><?php include_layout_template('header.php'); ?><?php echo output_message($message); ?>	<div id="data">		<form action="editjournal.php" method="post">		  <table>		        <input type="hidden" name="id"  value="<?php echo $current_record[0]->id; ?>" />		    <tr>		      <td align=right>Journal_Code:</td>		      <td>			<input type="text" name="journal_code" size="6" maxlength="6" value="<?php echo $current_record[0]->journal_code ?>" />		      </td>		      <td>Title abb:</td>		      <td colspan="7">		        <input type="text" name="title_abb" size="85" maxlength="100" value="<?php echo $current_record[0]->title_abb; ?>" />		      </td>		    </tr>		    <tr>		      <td>Title:</td>		      <td colspan="9">		        <input type="text" name="title" size="110" maxlength="200" value="<?php echo $current_record[0]->title; ?>" />		      </td>		    </tr>		    <tr>			<td>Lang code:</td>			 <td>			    <input type="text" name="lang_code" size="3" maxlength="3" value="<?php echo $current_record[0]->lang_code; ?>" />			 </td> 		      <td>Lib congress:</td>		      <td>			  <input type="text" name="lib_congress" size="20" maxlength="30" value="<?php echo $current_record[0]->lib_congress; ?>" />		      </td>			  <td align=right>Flag code:</td>			  <td>			    <input type="text" name="flag_code" size="1" maxlength="1" value="<?php echo $current_record[0]->flag_code; ?>" />			  </td>			  <td>UNCA flag:</td>			<td>		          <input type="text" name="unca_flag" size="1" maxlength="1" value="<?php echo $current_record[0]->unca_flag; ?>" />			</td>		    </tr>		    <tr>		      <td>ISSN code:</td>		      <td>		        <input type="text" name="issn_code" size="10" maxlength="10" value="<?php echo $current_record[0]->issn_code; ?>" />		      </td>		    </tr>		    <tr>		      <td>Old code:</td>		      <td>		        <input type="text" name="old_code" size="10" maxlength="20" value="<?php echo $current_record[0]->old_code; ?>" />		      </td>		      <td>New code:</td>		      <td>		        <input type="text" name="new_code" size="10" maxlength="20" value="<?php echo $current_record[0]->new_code; ?>" />		      </td>		      <td>Year discontinued:</td>		      <td>		        <input type="text" name="year_discontinued" size="4" maxlength="4" value="<?php echo $current_record[0]->year_discontinued; ?>" />		      </td>		      <td>Year started:</td>		      <td>		        <input type="text" name="year_started" size="4" maxlength="4" value="<?php echo $current_record[0]->year_started; ?>" />		      </td>		      <td>First vol:</td>		      <td>		        <input type="text" name="first_vol" size="10" maxlength="20" value="<?php echo $current_record[0]->first_vol; ?>" />		      </td>		    </tr>		    <tr>		      <td colspan="2">		        <input type="submit" name="delete" value="Delete" />		      </td>		      <td colspan="2">		        <input type="submit" name="save" value="Save" />		      </td>		      <td colspan="2">		       <a href="listjournals.php">Done</a>		      </td>		    </tr>		  </table>		</form><?php 	?></div><?php include_layout_template('footer.php'); ?>		