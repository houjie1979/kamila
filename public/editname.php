<?phprequire_once('../includes/initialize.php');$tablename = "NameAddress";if(isset($_GET['new'])) {	// new Form has been submitted  $nref['author_key'] = strtoupper(trim($_GET['author_key']));  $id="";    if(!$session->allow('enter')) $message = "Can't ";  $message = "Create new record in " . $tablename . " table"; }if (isset($_POST['edit'])) { // edit Form has been submitted.	$id = $_POST['id'];	$current_record = Names::find_rec_by_id($id);	$message = "Editing record " . $id . " of " . $tablename . " table";}if (isset($_GET['id'])) { // edit Form has been submitted via GET	$id = $_GET['id']; 	$current_record = Names::find_rec_by_id($id);	$message = "Editing record " . $id . " of " . $tablename . " table";}if(isset($_POST['clone'])) {	// clone author Form has been submitted	unset($nref['id']);	$nref['title'] = trim($_POST['title']);	$nref['first_name'] = trim($_POST['first_name']);	$nref['last_name'] = trim($_POST['last_name']);	$nref['department'] = trim($_POST['department']);	$nref['institution'] = trim($_POST['institution']);	$nref['street'] = trim($_POST['street']);	$nref['city'] = trim($_POST['city']);	$nref['state_code'] = strtoupper(trim($_POST['state_code']));	$nref['zip'] = trim($_POST['zip']);	$nref['country_code'] = trim($_POST['country_code']);	$nref['initials'] = strtoupper(trim($_POST['initials']));	$nref['phone'] = trim($_POST['phone']);	$nref['fax'] = trim($_POST['fax']);	$nref['email'] = trim($_POST['email']);	$nref['emp_by_code'] = trim($_POST['emp_by_code']);	$nref['medi_number'] = trim($_POST['medi_number']);	$nref['rank_abb'] = trim($_POST['rank_abb']);	$nref['verification'] = trim($_POST['verification']);	if($nref['author_key'] == "") $nref['author_key'] = Names::get_next_code(strtoupper($nref['last_name']));	$current_record[0] = Names::instantiateit($nref);    $message = "Clone record prepared for ". $nref['author_key'] . " author key ";}if(isset($_POST['save'])) {	// save author Form has been submitted	$nref['id'] = trim($_POST['id']);	$nref['author_key'] = strtoupper(trim($_POST['author_key']));	$nref['title'] = trim($_POST['title']);	$nref['first_name'] = trim($_POST['first_name']);	$nref['last_name'] = trim($_POST['last_name']);	$nref['department'] = trim($_POST['department']);	$nref['institution'] = trim($_POST['institution']);	$nref['street'] = trim($_POST['street']);	$nref['city'] = trim($_POST['city']);	$nref['state_code'] = strtoupper(trim($_POST['state_code']));	$nref['zip'] = trim($_POST['zip']);	$nref['country_code'] = trim($_POST['country_code']);	$nref['initials'] = strtoupper(trim($_POST['initials']));	$nref['phone'] = trim($_POST['phone']);	$nref['fax'] = trim($_POST['fax']);	$nref['email'] = trim($_POST['email']);	$nref['emp_by_code'] = trim($_POST['emp_by_code']);	$nref['medi_number'] = trim($_POST['medi_number']);	$nref['rank_abb'] = trim($_POST['rank_abb']);	$nref['verification'] = trim($_POST['verification']);	if($nref['author_key'] == "") $nref['author_key'] = Names::get_next_code($nref['last_name']); 	if($_POST['id'] != "" && $session->allow('update'))  {	// update existing record		$nref['id'] = $_POST['id'];	  	$current_record[0] = Names::instantiateit($nref);			if(Names::authenticate($current_record[0]->author_key)->id == $current_record[0]->id) { // update record			$current_record[0]->save();				$message = "Record updated in " . $tablename . " table";		}			else $message = "can't update record";				}	else {	// create new record	     if($session->allow('enter')){		unset($nref['id']);  		$current_record[0] = Names::instantiateit($nref);				if(Names::authenticate($current_record[0]->author_key))	$message = "Code already exists in " . $tablename . " table";		else {				$current_record[0]->save();			$message = "Record createded in " . $tablename . " table";		}			}   	  else $message = "Can't create new record. No create privilege";	}}   if (isset($_POST['delete'])) { // delete Form has been submitted.	if($_POST['id'] != "" && $session->allow('delete')) {		$delrecord = new Names;		$delrecord->id = $_POST['id'];		$message = "Record ".$delrecord->full_name. " is deleted from " . $tablename . " table.";		$delrecord->delete();		unset($id);	}    else $message = "Record is not deleted. No delete privilege";}   ?><?php include_layout_template('header.php'); ?><?php echo output_message($message); ?><div id="data">		<form action="editname.php" method="post">		  <table>		        <input type="hidden" name="id"  value="<?php echo $current_record[0]->id; ?>" />		    <tr>		      <td>Author key:</td>		      <td>		        <input type="text" name="author_key" size="7" maxlength="6" value="<?php echo $current_record[0]->author_key; ?>" />		      </td>		      <td>Title:</td>		      <td>		        <input type="text" name="title" size="6" maxlength="5" value="<?php echo $current_record[0]->title; ?>" />		      </td>		      <td>Rank abb:</td>		      <td>		        <input type="text" name="rank_abb" size="4" maxlength="3" value="<?php echo $current_record[0]->rank_abb; ?>" />		      </td>			</tr>			<tr>		      <td>First name:</td>		      <td>		        <input type="text" name="first_name" size="20" maxlength="50" value="<?php echo $current_record[0]->first_name; ?>" />		      </td>		      <td>Last name:</td>		      <td>		        <input type="text" name="last_name" size="20" maxlength="50" value="<?php echo $current_record[0]->last_name; ?>" />		      </td>			  <td>Initials:</td>		      <td>		        <input type="text" name="initials" size="6" maxlength="10" value="<?php echo $current_record[0]->initials; ?>" />		      </td>		    </tr>		    <tr>		      <td>Department:</td>		      <td colspan="6">		        <input type="text" name="department" size="87" maxlength="100" value="<?php echo $current_record[0]->department; ?>" />		      </td>		    </tr>		    <tr>		      <td>Institution:</td>		      <td colspan="6">		        <input type="text" name="institution" size="87" maxlength="100" value="<?php echo $current_record[0]->institution; ?>" />		      </td>			</tr>			<tr>		      <td>City:</td>		      <td>		        <input type="text" name="city" size="20" maxlength="50" value="<?php echo $current_record[0]->city; ?>" />		      </td>		      <td>State code:</td>		      <td>		        <input type="text" name="state_code" size="3" maxlength="2" value="<?php echo $current_record[0]->state_code; ?>" />		      </td>		      <td>Zip:</td>		      <td>		        <input type="text" name="zip" size="7" maxlength="10" value="<?php echo $current_record[0]->zip; ?>" />		      </td>			</tr>		    <tr>		      <td>Country code:</td>		      <td>		        <input list="country_code_list"  name="country_code"  size="11" maxlength="3" value="<?php echo $current_record[0]->country_code; ?>" />		      </td>		      <td>Street:</td>		      <td colspan="3">		        <input type="text" name="street" size="40" maxlength="50" value="<?php echo $current_record[0]->street; ?>" />		      </td>			</tr>			<tr>		      <td>Phone:</td>		      <td>		        <input type="text" name="phone" size="20" maxlength="20" value="<?php echo $current_record[0]->phone; ?>" />		      </td>		      <td>Fax:</td>		      <td>		        <input type="text" name="fax" size="20" maxlength="20" value="<?php echo $current_record[0]->fax; ?>" />		      </td>			</tr>		    <tr>		      <td>Email:</td>		      <td>		        <input type="text" name="email" size="30" maxlength="50" value="<?php echo $current_record[0]->email; ?>" />		      </td>			</tr>		    <tr>		      <td>Employed by code:</td>		      <td>		        <input type="text" name="emp_by_code" size="2" maxlength="1" value="<?php echo $current_record[0]->emp_by_code; ?>" />		      </td>		      <td>MERDJ number:</td>		      <td>		        <input type="text" name="medi_number" size="5" maxlength="4" value="<?php echo $current_record[0]->medi_number; ?>" />		      </td>		    </tr>		    <tr>		      <td>Verification:</td>		      <td colspan="6">		        <input type="text" name="verification" size="50" maxlength="100" value="<?php echo $current_record[0]->verification; ?>" />		      </td>		    </tr>			<tr><td colspan='2'><input type='submit' name = 'delete' value='Delete' /></td>				<td colspan='2'><input type='submit' name = 'clone' value='Clone' /></td>				<td colspan='2'><input type='submit' name = 'save' value='Save' /></td>				<td colspan='2'><a href="listnames.php">Done</a></td>			</tr>		  </table>		</form>		<datalist id="country_code_list">		    <option value ="CHN">		    <option value="JPN">		    <option value="USA">		</datalist></div><?php include_layout_template('footer.php'); ?>		