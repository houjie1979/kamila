<?phprequire_once('../includes/initialize.php');$tablename = "Data";if(isset($_GET['new'])) {	// new Form has been submitted  $nref['ref_key'] = strtoupper(trim($_GET['ref_key']));  $id="";    if(!$session->allow('enter')) $message = "Can't ";  $message .= "Create new record in " . $tablename . " table"; }if (isset($_POST['edit'])) { // edit Form has been submitted.	$id = $_POST['id']; 	$current_record = Data::find_rec_by_id($id);	$message = "Editing record " . $id . " of " . $tablename . " table";}if(isset($_POST['save'])) {	// save data Form has been submitted 		$ndat['id'] = trim($_POST['id']);		$ndat['ref_key'] = strtoupper(trim($_POST['ref_key']));		$ndat['dat_key'] = trim($_POST['dat_key']);		$ndat['medi_number'] = trim($_POST['medi_number']);		$ndat['isotope_code'] = strtoupper(trim($_POST['isotope_code']));		$ndat['source'] = trim($_POST['source']);		$ndat['source_temp'] = trim($_POST['source_temp']);		$ndat['absorber'] = trim($_POST['absorber']);		$ndat['absorber_temp'] = trim($_POST['absorber_temp']);		$ndat['isomer_shift'] = trim($_POST['isomer_shift']);		$ndat['quad_split'] = trim($_POST['quad_split']);		$ndat['comments'] = trim($_POST['comments']);		$ndat['abstractor'] = $session->username;		$ndat['prefix'] = trim($_POST['prefix']);		 	if($_POST['id'] != "" && $session->allow('update'))  {	// update existing record		$ndat['id'] = trim($_POST['id']);	  	$current_record[0] = Data::instantiateit($ndat);			if(Data::authenticate($current_record[0]->ref_key,$current_record[0]->dat_key)->id == $current_record[0]->id) { // update record			$current_record[0]->save();				$message = "Record updated in " . $tablename . " table";		}			else $message = "can't update record";				}	else {	// create new record		if($session->allow('enter')){		unset($nref['id']);  		$current_record[0] = Data::instantiateit($ndat);				if(Data::authenticate($current_record[0]->ref_key,$current_record[0]->dat_key))	$message = "Code already exists in " . $tablename . " table";		else {				$current_record[0]->save();			$message = "Record createded in " . $tablename . " table";		}			}   	  else $message = "Can't create new record. No create privilege";	}}if (isset($_POST['delete'])) { // delete Form has been submitted.    if($_POST['id'] != "" && $session->allow('delete')) {		$delrecord = new Data;		$delrecord->id = $_POST['id'];		$message = "Record ".$delrecord->full_name. " is deleted from " . $tablename . " table.";		$delrecord->delete();		unset($id);    }    else $message = "Record is not deleted. No delete privilege";}?><?php include_layout_template('header.php'); ?><?php echo output_message($message); ?>	<div id="data">		<form action="editdatas.php" method="post">		  <table>		        <input type="hidden" name="id"  value="<?php echo $current_record[0]->id; ?>" />		        <input type="hidden" name="medi_number"  value="<?php echo $current_record[0]->medi_number; ?>" />		    <tr>		      <td>Refkey:</td>		      <td>		        <input type="text" name="ref_key" size="6" maxlength="6" value="<?php echo $current_record[0]->ref_key; ?>" />		      </td>		      <td>Data key:</td>		      <td>		        <input type="text" name="dat_key" size="1" maxlength="1" value="<?php echo $current_record[0]->dat_key; ?>" />		      </td>		      <td>MERDJ number:</td>		      <td><?php echo $current_record[0]->medi_number; ?></br>		      <td>Abstractor:</td>		      <td><?php echo $current_record[0]->abstractor; ?></td>		    </tr>		    <tr>		      <td>Isotope code:</td>		      <td>		        <input type="text" name="isotope_code" size="3" maxlength="3" value="<?php echo $current_record[0]->isotope_code; ?>" />		      </td>		    </tr>		    <tr>		      <td>Source:</td>		      <td colspan="9">		        <input type="text" name="source" size="100" maxlength="150" value="<?php echo $current_record[0]->source; ?>" />		      </td>		    </tr>		    <tr>		      <td>Source temp:</td>		      <td>		        <input type="text" name="source_temp" size="6" maxlength="6" value="<?php echo $current_record[0]->source_temp; ?>" />		      </td>		    </tr>		    <tr>		      <td>Absorber:</td>		      <td colspan="9">		        <input type="text" name="absorber" size="100" maxlength="150" value="<?php echo $current_record[0]->absorber; ?>" />		      </td>		    </tr>		    <tr>		      <td>Absorber temp:</td>		      <td>		        <input type="text" name="absorber_temp" size="6" maxlength="6" value="<?php echo $current_record[0]->absorber_temp; ?>" />		      </td>		    </tr>		    <tr>				<td>Isomer shift:</td>		      <td>		        <input type="text" name="isomer_shift" size="8" maxlength="8" value="<?php echo $current_record[0]->isomer_shift; ?>" />		      </td>		      <td>Quad split:</td>		      <td>		        <input type="text" name="quad_split" size="8" maxlength="8" value="<?php echo $current_record[0]->quad_split; ?>" />		      </td>		    </tr>		    <tr>		      <td>Comments:</td>		      <td colspan="9">		        <input type="text" name="comments" size="100" maxlength="200" value="<?php echo $current_record[0]->comments; ?>" />		      </td>		    </tr>		    <tr>			  <td colspan="2">		        <input type="submit" name="delete" value="Delete" />		      </td>		      <td colspan="2">		        <input type="submit" name="save" value="Save" />		      </td>		      <td colspan='2'><a href="listdatas.php">Done</a></td>		    </tr>		  </table>		</form></div><?php include_layout_template('footer.php'); ?>		