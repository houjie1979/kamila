<?phprequire_once('../includes/initialize.php');$anumber = 10;//$found_records[20] = new Authors;$medi = $session->medi;if(isset($_POST['getref'])) {	// get authors Form has been submitted	if($_POST['anumber'] != "") $anumber = $_POST['anumber']; else $anumber = 10;	if($_POST['medi'] == "") $medi = $session->medi; else { $medi = trim($_POST['medi']); $session->set_medi($medi); }    $refkey = strtoupper(trim($_POST['refkey']));	$found_records = Authors::get_by_refkey($refkey);	if(isset($found_records)) {		$message = "Found ". count($found_records). " authors for ".$refkey; 		}	else $message = "No records found for ".$refkey;}if(isset($_POST['save']) ) {	// save authors Form has been submitted	if( $session->allow('update')){	if($_POST['anumber'] != "") $anumber = $_POST['anumber']; else $anumber = 10;	$refkey = $_POST['ref_key'];	$medi = $_POST['medi_num'];	$na = 0;	for($i = 0; $i <= $anumber; $i++ ) {		$k = "authorkey".$i;		if($_POST["{$k}"] != "" ) {			$entry['author_key'] = strtoupper(trim($_POST["{$k}"]));			$d = "id".$i;  $entry['id'] = $_POST["{$d}"];			$p = "authpos".$i;  $entry['author_position'] = strtoupper(trim($_POST["{$p}"]));			$c = "cauthflag".$i;  $entry['cauthor_flag'] = strtoupper(trim($_POST["{$c}"]));			$entry['ref_key'] = $refkey;			$entry['medi_num'] = $medi;			$author = Authors::instantiateit($entry);			if($author->save()) $na++;			$found_records = Authors::get_by_refkey($refkey);			}		else {		// delete record with cleared author_key or ignore empty lines			$d = "id".$i;			if($_POST["{$d}"] != ""){				if($session->allow('delete')){					$rectodelete['id'] = $_POST["{$d}"];					$autodel = Authors::instantiateit($rectodelete);					$autodel->delete();				}				else $message = "Delete is not allowed";			}		}	}	$message = "Saved ".$na." authors for ".$refkey;	}	else $message = "No update privelege";} 	$found_records = Authors::get_by_refkey($refkey);	if(isset($found_records)) {		$message = "Found ". count($found_records). " authors for ".$refkey; 		}	else $message = "No records found for ".$refkey;?><?php include_layout_template('header.php'); ?><div id="leftcol"><h3>Flag Authors</h3>		<form action="flagauthors.php" method="post">		  <table>		    <tr>		      <td>MERDJ issue:</td>		      <td>		        <input type="text" name="medi" size="4" maxlength="4" value="<?php echo $medi; ?>" />		      </td>		    </tr>		    <tr>		      <td>Ref code:</td>		      <td>		        <input type="text" name="refkey" size="6" maxlength="6" value="<?php echo $refkey; ?>" />		      </td>		    </tr>			<tr>			  <td>Number of authors:</td>		      <td>		        <input type="text" name="anumber" size="2" maxlength="2" value="<?php echo $anumber; ?>" />		      </td>			<tr>		      <td >		        <input type="submit" name="getref" value="Get" />			  </td>	  </table>		  </br>		  </br>	<form action=''> <input type="button" onclick="OpenInNewTab('checkname.php');" value="Checkup name"/></form><?php	echo $message."</br>"; ?></div>		<div id="data">		<form action="flagauthors.php" method="post">		<input type="hidden" name="medi_num" value="<?php echo $medi; ?>" />		<input type="hidden" name="ref_key" value="<?php echo $refkey; ?>" />		  <table><?php	for($i = 0; $i<=$anumber; $i++ ) {		echo "<input type='hidden' name='id".$i."' value= '".$found_records[$i]->id."' />";			echo "<tr><td><input type='text' name='authpos".$i."' size='2' maxlength='2' value='".$found_records[$i]->author_position."'/></td>";		echo "<td><input type='text' name='authorkey".$i."' size='6' maxlength='6' value='".$found_records[$i]->author_key."'/></td> ";		echo "<td><input type='text' name='cauthflag".$i."' size='1' maxlength='1' value='".$found_records[$i]->cauthor_flag."'/></td>";		echo "<td>".$found_records[$i]->ref_key." ".$found_records[$i]->medi_num." ".$found_records[$i]->author_name." ".$found_records[$i]->affiliation."</td>";	}?>			<tr><td colspan='2'><input type='submit' name = 'save' value='Save' /></td></tr>		  </table>	  		</form><?php ?></div><?php include_layout_template('footer.php'); ?>		