<?phprequire_once('../includes/initialize.php');	if(isset($_POST['medi'])) {	    $medi = trim($_POST['medi']);		$session->set_medi($medi);		}	else	$medi = $session->medi;if(isset($_POST['printabbr'])) {	// search abbreviations Form has been submitted	$found_records = Abbreviations::print_issue($medi);	$message = "Searched abbreviations for ".$medi;}if(isset($_POST['saveabbr'])) {	// save abbreviations Form has been submitted	$found_records = Abbreviations::print_issue($medi);	$handle = fopen('..' . DS . 'outputs' . DS . $medi."abbreviations", "w");	foreach($found_records as $record){		fwrite($handle, $record->abbr_code.chr(9).$record->definition.chr(10));	}	fclose($handle);	$message = "Saved abbreviations ".$medi." in the file ".$medi."abbreviations";}if(isset($_POST['printdata'])) {	// search data Form has been submitted	$found_records = Data::compose_issue_data($medi);	$message = "Searched data for ".$medi;}if(isset($_POST['savedata'])) {	// save data Form has been submitted	$found_records = Data::compose_issue_data($medi);	$handle = fopen('..' . DS . 'outputs' . DS . $medi."data", "w");	$sbjhead = "";	foreach($found_records as $record) {  $record->add_header();  }	foreach($found_records as $record) {		if($record->head != $sbjhead) { 			$sbjhead = $record->head;			fwrite($handle, $record->print_data_line($sbjhead));		}		fwrite($handle, $record->print_data_line(""));	}	fclose($handle);	$message = "Saved data for ".$medi." in the file ".$medi."data";}if(isset($_POST['printisotope'])) {	// search isotope Form has been submitted	$found_records = Data::compose_issue_isotope($medi);	foreach($found_records as $record) $record->add_definitions();	$message = "Searched isotopes for ".$medi;}if(isset($_POST['saveisotope'])) {	// save isotope Form has been submitted	$found_records = Data::compose_issue_isotope($medi);	foreach($found_records as $record) $record->add_definitions();	$handle = fopen('..' . DS . 'outputs' . DS . $medi."isotope", "w");	fwrite($handle, Data::compose_isotope_list($medi));	fclose($handle);	$message = "Saved isotopelist for ".$medi." in the file ".$medi."isotope";}if(isset($_POST['printrefs'])) {	// search refs Form has been submitted	$found_records = References::compose_issue_refs($medi);	foreach($found_records as $record) $record->add_definitions();	$message = "Searched references for ".$medi;}if(isset($_POST['saverefs'])) {	// save refs Form has been submitted	$found_records = References::compose_issue_refs($medi);	foreach($found_records as $record) $record->add_definitions();	$handle = fopen('..' . DS . 'outputs' . DS . $medi."refs", "w");	foreach($found_records as $record){		fwrite($handle, $record->print_ref());	}	fclose($handle);	$message = "Saved references for ".$medi." in the file ".$medi."refs";}if(isset($_POST['printsubj'])) {	// search subject Form has been submitted	$found_records = Keywords::compose_issue_subject($medi);	$message = "Searched subjects for ".$medi;}if(isset($_POST['savesubj'])) {	// save subject Form has been submitted	$found_records = Keywords::compose_issue_subject($medi);	foreach($found_records as $record) $record->add_definitions();	$subtitle = $found_records[0]->subject;	$out = $subtitle.",\"";	$handle = fopen('..' . DS . 'outputs' . DS . $medi."subject", "w");	foreach($found_records as $record){		if($subtitle == $record->subject) $out .= $record->ref_key.",";		else {			$out = substr($out, 0, strlen($out)-1);			$out = $out."\"".chr(10);			fwrite($handle, $out);			$subtitle = $record->subject;			$out = $subtitle.",\"".$record->ref_key.",";		}	}	$out = substr($out, 0, strlen($out)-1);	$out = $out."\"";	fwrite($handle, $out);	fclose($handle);	$message = "Saved subjects for ".$medi." in the file ".$medi."subject";}if(isset($_POST['printauth'])) {	// search authors Form has been submitted	$found_records = Data::compose_author_index($medi);	$message = "Searched authors for ".$medi;}if(isset($_POST['saveauth'])) {		// save authors Form has been submitted		        	$found_records = Names::compose_author_index($medi);		$handle = fopen($medi."authors", "w");	$prevname = "start file";	$previsot = "";	$out = "";	foreach($found_records as $record){	    $authorname = $record->last_name . ", " . $record->initials;	    if($record->author_key != $prevname){				// new author line		if($prevname != "start file") { $out .= "\"" . chr(10); } // close previous line		$out .= "\"" . $authorname . "\",\"" . $record->keyword_code ."\",\"" . $record->ref_key;		$rcount = 1;	    }	    else{		if($record->keyword_code != $previsot){				// new topic, same author line		    $out .= "\"" . chr(10) . "\" \",\"" . $record->keyword_code . "\",\"" . $record->ref_key;		    $rcount = 1;		    }		    else{						// same topic, same author continue			$rcount++;			if($rcount <= 4) {				//			    $out .= "&" . $record->ref_key;			}			else{						//			    $out .= " " . $record->ref_key;			    $rcount = 1;			}		    }		}	    			    $prevname = $record->author_key;	    $previsot = $record->keyword_code;	}	$out .= "\"" . chr(10);	fwrite($handle, $out);	fclose($handle);	$message = "Saved authors for ".$medi." in the file ".$medi."authors";}?><?php include_layout_template('header.php'); ?><div id="leftcol"><h3>Print Issue</h3>		<form action="printissue.php" method="post">			<input type="hidden" name="medi" value="<?php echo $medi; ?>" />		  <table>		    <tr>		      <td>MERDJ #:</td>		      <td>		        <input type="text" name="medi" size="6" maxlength="4" value="<?php echo $medi; ?>" />		      </td>		    </tr>			<tr>		      <td >		        <input type="submit" name="printabbr" value="Print abbr     " />			  </td>			  <td >		        <input type="submit" name="saveabbr" value="Save abbr     " />			  </td>    		</tr>			<tr>		      <td >		        <input type="submit" name="printdata" value="Print data     " />			  </td>			  <td >		        <input type="submit" name="savedata" value="Save data     " />			  </td>    		</tr>			<tr>		      <td >		        <input type="submit" name="printisotope" value="Print isotops" />			  </td>			  <td >		        <input type="submit" name="saveisotope" value="Save isotops" />			  </td>    		</tr>			<tr>		      <td >		        <input type="submit" name="printrefs" value="Print refs      " />			  </td>			  <td >		        <input type="submit" name="saverefs" value="Save refs      " />			  </td>    		</tr>			<tr>		      <td >		        <input type="submit" name="printsubj" value="Print subj     " />			  </td>			  <td >		        <input type="submit" name="savesubj" value="Save subj     " />			  </td>    		</tr>    		</tr>			<tr>		      <td >		        <input type="submit" name="printauth" value="Print auth     " />			  </td>			  <td >		        <input type="submit" name="saveauth" value="Save auth     " />			  </td>    		</tr>	  </table>		  </br>		  </br><?php	echo $message."</br>"; ?><?php /*	$current_page = $pagination->next_page()-1;	echo "Found - ". $total_count . "<br/>Page ". $current_page ." out of ". $pagination->total_pages() . "<br/>";	if($pagination->total_pages() > 1) {			if($pagination->has_previous_page()){			echo " <a href=\"listregions.php?page=";			echo $pagination->previous_page();			echo "&sql=".$refsql."\">&laquo; Previous</a> ";		}			if($pagination->has_next_page()){			echo " <a href=\"listregions.php?page=";			echo $pagination->next_page();			echo "&sql=".$refsql."\">Next &raquo; </a> ";		}		}*/?></div>		<div id="data"><?php if(isset($found_records)) {foreach($found_records as $record){		echo "<table>				<tr>					<td>".$record->code_name()."</td>						<td>					</td>				</tr>			</table>";		}	}?></div><?php include_layout_template('footer.php'); ?>		