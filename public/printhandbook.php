<?phprequire_once('../includes/initialize.php');	if(isset($_POST['kwd1'])) {	    $kwd1 = strtoupper(trim($_POST['kwd1']));		}	if(isset($_POST['kwd2'])) {	    $kwd2 = strtoupper(trim($_POST['kwd2']));		}if(isset($_POST['printabbr'])) {	// search abbreviations Form has been submitted	$found_records = Abbreviations::print_handbook();	$message = "Searched abbreviations for handbook";}if(isset($_POST['saveabbr'])) {	// save abbreviations Form has been submitted	$found_records = Abbreviations::print_handbook();	$handle = fopen('..' . DS . 'outputs' . DS . "HBabbreviations" .$kwd1.$kwd2, "w");	foreach($found_records as $record){		fwrite($handle, $record->abbr_code.chr(9).$record->definition.chr(10));	}	fclose($handle);	$message = "Saved handbook abbreviations in the file "."HBabbreviations".$kwd1.$kwd2;}if(isset($_POST['printdata'])) {	// search data Form has been submitted	$found_records = Data::compose_hb_data($kwd1, $kwd2);	$message = "Searched data for ".$kwd1.$kwd2;}if(isset($_POST['savedata'])) {	// save data Form has been submitted	$found_records = Data::compose_hb_data($kwd1, $kwd2);	$handle = fopen('..' . DS . 'outputs' . DS . "HBdata".$kwd1.$kwd2, "w");	$sbjhead = "";	foreach($found_records as $record) {  $record->add_header();  }	foreach($found_records as $record) {		if($record->head != $sbjhead) { 			$sbjhead = $record->head;			fwrite($handle, $record->print_data_line($sbjhead));		}		fwrite($handle, $record->print_data_line(""));	}	fclose($handle);	$message = "Saved data for handbook in the file HBdata".$kwd1.$kwd2;}if(isset($_POST['printisotope'])) {	// search isotope Form has been submitted	$found_records = Data::compose_hb_isotope($kwd1, $kwd2);	foreach($found_records as $record) $record->add_definitions();	$message = "Searched isotopes for handbook ".$kwd1. $kwd2;}if(isset($_POST['saveisotope'])) {	// save isotope Form has been submitted	$found_records = Data::compose_hb_isotope($kwd1, $kwd2);	foreach($found_records as $record) $record->add_definitions();	$handle = fopen('..' . DS . 'outputs' . DS . "HBisotope".$kwd1. $kwd2, "w");	fwrite($handle, Data::compose_hbisotope_list($kwd1, $kwd2));	fclose($handle);	$message = "Saved isotopelist for ".$kwd1. $kwd2." in the file HBisotope".$kwd1. $kwd2;}if(isset($_POST['printrefs'])) {	// search refs Form has been submitted	$found_records = References::compose_hb_refs($kwd1, $kwd2);//	foreach($found_records as $record) $record->add_definitions();	$message = "Searched references for ".$kwd1. $kwd2;}if(isset($_POST['saverefs'])) {	// save refs Form has been submitted	$found_records = References::compose_hb_refs($kwd1, $kwd2);//	foreach($found_records as $record) $record->add_definitions();	$handle = fopen('..' . DS . 'outputs' . DS . "HBrefs".$kwd1. $kwd2, "w");	foreach($found_records as $record){		fwrite($handle, $record->print_ref());	}	fclose($handle);	$message = "Saved references for handbook in the file HBrefs".$kwd1. $kwd2;}if(isset($_POST['printsubj'])) {	// search subject Form has been submitted	$found_records = Keywords::compose_hb_subject($kwd1, $kwd2);	$message = "Searched subjects for handbook ".$kwd1. $kwd2;//	echo $found_records[0]->ref_key. "  ".$found_records[1]->keyword_code;}if(isset($_POST['savesubj'])) {	// save subject Form has been submitted	$found_records = Keywords::compose_hb_subject($kwd1, $kwd2);	foreach($found_records as $record) $record->add_definitions();	$subtitle = $found_records[0]->subject;	$out = $subtitle.",\"";	$handle = fopen('..' . DS . 'outputs' . DS . "HBsubject".$kwd1. $kwd2, "w");	foreach($found_records as $record){		if($subtitle == $record->subject) $out .= $record->ref_key.",";		else {			$out = substr($out, 0, strlen($out)-1);			$out = $out."\"".chr(10);			fwrite($handle, $out);			$subtitle = $record->subject;			$out = $subtitle.",\"".$record->ref_key.",";		}	}	$out = substr($out, 0, strlen($out)-1);	$out = $out."\"";	fwrite($handle, $out);	fclose($handle);	$message = "Saved subjects for handbook in the file HBsubject".$kwd1. $kwd2;}if(isset($_POST['printauth'])) {	// search authors Form has been submitted	$found_records = Names::compose_hb_index($kwd1, $kwd2);	$message = "Searched authors for handbook ".$kwd1. $kwd2;}if(isset($_POST['saveauth'])) {		// save authors Form has been submitted		        	$found_records = Names::compose_hb_index($kwd1, $kwd2);		$handle = fopen('..' . DS . 'outputs' . DS . "HBauthors".$kwd1. $kwd2, "w");	$prevname = "start file";	$previsot = "";	$out = "";	foreach($found_records as $record){	    $authorname = $record->last_name . ", " . $record->initials;	    if($record->author_key != $prevname){				// new author line		if($prevname != "start file") { $out .= "\"" . chr(10); } // close previous line		$out .= "\"" . $authorname . "\",\"" . $record->keyword_code ."\",\"" . $record->ref_key;		$rcount = 1;	    }	    else{		if($record->keyword_code != $previsot){				// new topic, same author line		    $out .= "\"" . chr(10) . "\" \",\"" . $record->keyword_code . "\",\"" . $record->ref_key;		    $rcount = 1;		    }		    else{						// same topic, same author continue			$rcount++;			if($rcount <= 4) {				//			    $out .= "&" . $record->ref_key;			}			else{						//			    $out .= " " . $record->ref_key;			    $rcount = 1;			}		    }		}	    			    $prevname = $record->author_key;	    $previsot = $record->keyword_code;	}	$out .= "\"" . chr(10);	fwrite($handle, $out);	fclose($handle);	$message = "Saved authors for handbook in the file HBauthors".$kwd1. $kwd2;}?><?php include_layout_template('header.php'); ?><div id="leftcol"><h3>Print Handbook</h3>		<form action="printhandbook.php" method="post">		  <table>		    <tr>		      <td>Keyword 1:</td>		      <td>		        <input type="text" name="kwd1" size="4" maxlength="3" value="<?php echo $kwd1; ?>" />		      </td>		    </tr>		    <tr>		      <td>Keyword 2:</td>		      <td>		        <input type="text" name="kwd2" size="4" maxlength="3" value="<?php echo $kwd2; ?>" />		      </td>		    </tr>			<tr>		      <td >		        <input type="submit" name="printabbr" value="Print abbr     " />			  </td>			  <td >		        <input type="submit" name="saveabbr" value="Save abbr     " />			  </td>    		</tr>			<tr>		      <td >		        <input type="submit" name="printdata" value="Print data     " />			  </td>			  <td >		        <input type="submit" name="savedata" value="Save data     " />			  </td>    		</tr>			<tr>		      <td >		        <input type="submit" name="printisotope" value="Print isotops" />			  </td>			  <td >		        <input type="submit" name="saveisotope" value="Save isotops" />			  </td>    		</tr>			<tr>		      <td >		        <input type="submit" name="printrefs" value="Print refs      " />			  </td>			  <td >		        <input type="submit" name="saverefs" value="Save refs      " />			  </td>    		</tr>			<tr>		      <td >		        <input type="submit" name="printsubj" value="Print subj     " />			  </td>			  <td >		        <input type="submit" name="savesubj" value="Save subj     " />			  </td>    		</tr>    		</tr>			<tr>		      <td >		        <input type="submit" name="printauth" value="Print auth     " />			  </td>			  <td >		        <input type="submit" name="saveauth" value="Save auth     " />			  </td>    		</tr>	  </table>		  </br>		  </br><?php	echo $message."</br>"; ?><?php /*	$current_page = $pagination->next_page()-1;	echo "Found - ". $total_count . "<br/>Page ". $current_page ." out of ". $pagination->total_pages() . "<br/>";	if($pagination->total_pages() > 1) {			if($pagination->has_previous_page()){			echo " <a href=\"listregions.php?page=";			echo $pagination->previous_page();			echo "&sql=".$refsql."\">&laquo; Previous</a> ";		}			if($pagination->has_next_page()){			echo " <a href=\"listregions.php?page=";			echo $pagination->next_page();			echo "&sql=".$refsql."\">Next &raquo; </a> ";		}		}*/?></div>		<div id="data"><?php if(isset($found_records)) {foreach($found_records as $record){		echo "<table>				<tr>					<td>".$record->code_name()."</td>						<td>					</td>				</tr>			</table>";		}	}?></div><?php include_layout_template('footer.php'); ?>		