<?php// Setting the Content-Type header with charsetheader('Content-Type: text/html; charset=utf-8');	// 1. Create a database connection	$connection = mysql_connect("localhost","STAFFUSER","DALIAN2018");	if(!$connection)	{	die("Database connection failed: ".mysql_error()); }	// 2. Select a database to use	$db_select = mysql_select_db("kamila",$connection);	if(!$db_select)	{ die("Database selection failed: ".mysql_error()); }?><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Reading from file isotope</title></head><body><?phpecho"trying to write to kamila database table journals<br/>";mysql_set_charset('utf8',$connection);/*		$query = 'INSERT INTO isotopes            ( refcode, isocode, source, absorber, stemp, atemp, ishift, qsplit, ecomments, keywords)            VALUES ( "xxx", "xxx", "xxx","xxx", "xxx",  "xxx", "111", "222", "x (x) x", "x &x x" ) ';//            VALUES ( {$refcode}, {$isotope}, {$matrix}, {$absorber}, {$Stemp},  {$Atemp}, {$ishift}, {$qsplit}, {$comment}, {$key} )";		$result = mysql_query($query, $connection);		if(!$result)		{ die("Database query failed: " . mysql_error()); }*/$previous_ref="";$handle = fopen("Journals", "r");if(!$handle) {echo "can not open file"; exit;}    while (($buffer = fgetCRstr($handle)) !== false) {//       echo $buffer."<br/>";		list($pos1,$pos2,$pos3,$pos4) = explode(";", $buffer);//		echo "exploded___".$pos1. "___".$pos2."___".$pos3."___".$pos4. "<br/>";//		echo "repeat___".$pos1. "<br/>";//		$title = utf8_encode($title);//		echo $pos1;//		echo substr($pos1,1)."---";		if( $pos1 == "C" )		{ //			echo $pos1. "___".$pos2."___".$pos3."___".$pos4. "<br/>"; 			if(substr($pos2,0,1)=="Y")			{				$recno = substr($pos2,1);			//	echo "<br/>"."record". $recno;				if ($pos3=="X1") $ref_code=$pos4;	//			$reference[$recno]["ref_code"]= $pos4;				$reference["jcode"]=inquotes($ref_code);	//			echo $reference["refcode"];				echo "_".$recno."</br>";			}			else 			{				switch ($pos2)				{					case "X1": echo "field1___";					break;					case "X2": 						$authors=inquotes($pos3);						$reference["tabb"]=$authors;	//					echo $reference["authors"]."___";											break;							case "X3": 						$journal=inquotes($pos3);						$reference["title"]=$journal;	//					echo $reference[$recno]["journal"]."___";					break;					case "X4": 						$vol=inquotes($pos3);						$reference["lang"]=$vol;	//					echo $reference[$recno]["vol"]."___";							break;					case "X5": 						$page=inquotes($pos3);						$reference["libcon"]=$page;	//					echo $reference[$recno]["page"]."___";							break;											case "X6": 						$issue=inquotes($pos3);						$reference["trans"]=$issue;	//					echo $reference[$recno]["issue"]."___";						break;					case "X7": 						$year=inquotes($pos3);						$reference["com"]=$year;			//			echo $reference[$recno]["year"]."___";										break;					case "X8": 						$title=inquotes($pos3);						$reference["unca"]=$title;				//		echo $reference[$recno]["title"]."___";										break;					case "X9": 						$lang=inquotes($pos3);						$reference["lib"]=$lang;			//			echo $reference[$recno]["lang"]."___";										break;					case "X10": 						$lang=inquotes($pos3);						$reference["flag"]=$lang;			//			echo $reference[$recno]["lang"]."___";										break;					case "X11": 						$lang=inquotes($pos3);						$reference["disc"]=$lang;			//			echo $reference[$recno]["lang"]."___";										break;					case "X12": 						$lang=inquotes($pos3);						$reference["old"]=$lang;			//			echo $reference[$recno]["lang"]."___";										break;					case "X13": 						$lang=inquotes($pos3);						$reference["new"]=$lang;			//			echo $reference[$recno]["lang"]."___";										break;					case "X14": 						$lang=inquotes($pos3);						$reference["yearstart"]=$lang;			//			echo $reference[$recno]["lang"]."___";										break;					case "X15": 						$lang=inquotes($pos3);						$reference["firstv"]=$lang;			//			echo $reference[$recno]["lang"]."___";										break;					case "X16": 						$lang=inquotes($pos3);						$reference["lastv"]=$lang;			//			echo $reference[$recno]["lang"]."___";										break;					case "X17": 						$keywords=inquotes($pos3);						$reference["issn"]=$keywords;			//			echo $reference[$recno]["keywords"]."___";							$query = "INSERT INTO journals            					( journal_code, title_abb, title, lang_code, lib_congress,							 trans_code, comments, unca_flag, library_code, flag_code,							year_discontinued, old_code, new_code, year_started,							first_vol,last_vol, issn_code	)            					VALUES (\"{$reference['jcode']}\",								 \"{$reference['tabb']}\",								 \"{$reference['title']}\",								 \"{$reference['lang']}\",								 \"{$reference['libcon']}\",								 \"{$reference['trans']}\",								 \"{$reference['com']}\",								 \"{$reference['unca']}\",								 \"{$reference['lib']}\",						 		 \"{$reference['flag']}\", ";						if($reference['disc'] != "") $query .= "\"{$reference['disc']}\",";						else $query .= " NULL, ";						$query .= " \"{$reference['old']}\",						 \"{$reference['new']}\", ";						if($reference['yearstart'] != "") $query .= "\"{$reference['yearstart']}\",";						else $query .= " NULL, ";						$query .= " \"{$reference['firstv']}\",						 \"{$reference['lastv']}\",						\"{$reference['issn']}\"		  )";		//				echo $query;						if($previous_ref != $reference['jcode']) {							$result = mysql_query($query, $connection);		 	//					echo "<br/> {$result} <br/>";							if(!$result)	{ die("Database query failed: " . mysql_error()); }												else { $previous_ref = $reference['jcode'];}						} // if $previous						else echo "DUPLICATE=".$reference['jcode']."_";					break;				}	// of switch							}	// of else		}	// of if pos1==C//		else echo "???___";		/*		$query = "INSERT INTO refs            ( refcode, authors, journal, vol, issue, pages, year, title, lang, keywords)            VALUES (\"{$refcode}\", \"{$authors}\", \"{$journal}\", \"{$vol}\", \"{$issue}\", \"{$pages}\", \"{$year}\", \"{$title}\", \"{$lang}\", \"{$key}\" )";			echo $query;		$result = mysql_query($query, $connection); 	echo "<br/> {$result} <br/>";		if(!$result)	{ die("Database query failed: " . mysql_error()); }*///		mysql_query(SELECT LAST_INSERT_ID());//		echo fetch_result/*		if ($ishift != '') 		{			$query = "UPDATE";		}*/    }	//of whileecho $recno;fclose($handle);mysql_close($connection);function inquotes($instring){	$outstring=substr($instring,2);	$outstring=substr($outstring,0,strpos($outstring,"\""));	return $outstring;}function fgetCRstr($h){	$line = ""; 	$CR = FALSE;	$EOF = FALSE;	if( ! feof($h)) {		while( ! $CR && ! $EOF ) { 			if( ! feof($h)) {				$ch = fgetc($h); 				if($ch != chr(13)) $line .= $ch; else $CR = TRUE; 			}			else $EOF = TRUE;		}		return $line;	} else return FALSE;}?></body></html>