<?php// Setting the Content-Type header with charsetheader('Content-Type: text/html; charset=utf-8');require_once("../includes/config.php");	// 1. Create a database connection	$connection = mysql_connect(DB_SERVER, DB_USER, DB_PASS);	if(!$connection)	{	die("Database connection failed: ".mysql_error()); }	// 2. Select a database to use	$db_select = mysql_select_db(DB_NAME,$connection);	if(!$db_select)	{ die("Database selection failed: ".mysql_error()); }?><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Reading from file state</title></head><body><?phpecho"trying to write to wad database table state<br/>";mysql_set_charset('utf8',$connection);$previous_ref="";$handle = fopen("State_code", "r");if(!$handle) {echo "can not open file"; exit;}    while (($buffer = fgetCRstr($handle)) !== false) {		list($pos1,$pos2,$pos3,$pos4) = explode(";", $buffer);		if( $pos1 == "C" )		{ 			if(substr($pos2,0,1)=="Y")			{				$recno = substr($pos2,1);				if ($pos3=="X1") $ref_code=$pos4;				$reference["refcode"]=inquotes($ref_code);				echo $reference["refcode"];				echo "_".$recno."_";			}			else 			{				switch ($pos2)				{					case "X1": echo "field1___";					break;					case "X2": 						$authors=inquotes($pos3);						$reference["authors"]=$authors;						echo $reference["authors"]."___";						$query = "INSERT INTO state_code            					( state_code, state)            					VALUES (\"{$reference['refcode']}\",								 \"{$reference['authors']}\"		  )";						if($previous_ref != $reference['refcode']) {							$result = mysql_query($query, $connection);		 								if(!$result)	{ die("Database query failed: " . mysql_error()); }												else { $previous_ref = $reference['refcode'];}						} // if $previous						else echo "DUPLICATE=".$reference['refcode']."_";					break;				}	// of switch							}	// of else		}	// of if pos1==C    }	//of whileecho $recno;fclose($handle);mysql_close($connection);function inquotes($instring){	$outstring=substr($instring,2);	$outstring=substr($outstring,0,strpos($outstring,"\""));	return $outstring;}function fgetCRstr($h){	$line = ""; 	$CR = FALSE;	$EOF = FALSE;	if( ! feof($h)) {		while( ! $CR && ! $EOF ) { 			if( ! feof($h)) {				$ch = fgetc($h); 				if($ch != chr(13)) $line .= $ch; else $CR = TRUE; 			}			else $EOF = TRUE;		}		return $line;	} else return FALSE;}?></body></html>